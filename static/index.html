<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidSnatch - Futuristic Video Downloader</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon_io/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon_io/apple-touch-icon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Aurora Background Animation */
        .aurora-bg {
            background: linear-gradient(-45deg, #0D1117, #1F1A33, #4A0D35, #0D1117);
            background-size: 400% 400%;
            animation: aurora 15s ease infinite;
        }
        
        @keyframes aurora {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Glow effects */
        .glow-cyan {
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        
        .glow-cyan-text {
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Logo styling */
        .logo-container {
            position: relative;
            display: inline-block;
        }
        
        .logo-image {
            filter: drop-shadow(0 0 15px rgba(0, 255, 255, 0.4));
            opacity: 0.9;
            transition: all 0.3s ease;
        }
        
        .logo-image:hover {
            filter: drop-shadow(0 0 25px rgba(0, 255, 255, 0.6));
            opacity: 1;
            transform: scale(1.05);
        }
        
        /* Pulsing glow */
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulseGlow {
            from { box-shadow: 0 0 5px rgba(0, 255, 255, 0.5); }
            to { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
        }
        
        /* Loading spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid #00FFFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fancy download loading indicator */
        .download-loading {
            position: relative;
            overflow: hidden;
        }
        
        .download-loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.4), transparent);
            animation: downloadShimmer 2s linear infinite;
        }
        
        @keyframes downloadShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Selected quality highlight */
        .selected-quality {
            background: linear-gradient(135deg, #00FFFF, #4A0D35) !important;
            color: black !important;
            border-color: #00FFFF !important;
        }
        
        /* Button lift effect */
        .lift:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }
        
        /* Custom slider styling */
        .slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00FFFF, #8B5CF6);
            cursor: pointer;
            border: 2px solid #1F1A33;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        .slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00FFFF, #8B5CF6);
            cursor: pointer;
            border: 2px solid #1F1A33;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        /* Tab styling */
        .tab-btn {
            background: rgba(0, 0, 0, 0.3);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transform: scale(0.95);
        }
        
        .tab-btn:hover {
            background: rgba(0, 255, 255, 0.1);
            color: #00FFFF;
            border-color: rgba(0, 255, 255, 0.4);
            transform: scale(1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }
        
        .active-tab {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(139, 92, 246, 0.2)) !important;
            color: #00FFFF !important;
            border-color: #00FFFF !important;
            transform: scale(1) !important;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3), inset 0 0 20px rgba(0, 255, 255, 0.1) !important;
        }
        
        /* Tab content styling */
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .active-content {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Fade in animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Progress bar */
        .progress-bar {
            background: linear-gradient(90deg, #00FFFF, #4A0D35);
            animation: progressFill 3s ease-in-out;
        }
        
        @keyframes progressFill {
            from { width: 0%; }
            to { width: 100%; }
        }

        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff8a8a;
            text-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
            padding: 12px 20px;
            border-radius: 9999px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .error-message.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="aurora-bg min-h-screen flex items-center justify-center p-4">
    <div class="glass rounded-3xl p-8 w-full max-w-2xl">
        <!-- Header & Logo -->
        <div class="text-center mb-12">
            <div class="logo-container mb-6">
                <img src="/static/vidsnatch-logo.png" alt="VidSnatch Logo" class="logo-image mx-auto h-16 w-auto">
            </div>
            <h1 class="text-4xl font-light text-white mb-2">
                <span class="font-normal">Vid</span><span class="font-bold glow-cyan-text" style="color: #00FFFF;">Snatch</span>
            </h1>
            <p class="text-gray-400 text-sm">The future of youtube video downloading</p>
        </div>
        
        <!-- Main Input Section -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row gap-4">
                <input 
                    id="videoUrl" 
                    type="text" 
                    placeholder="Paste your youtube video link here..."
                    class="flex-1 px-6 py-4 rounded-full bg-black/30 border-none text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-400 pulse-glow"
                />
                <button 
                    id="snatchBtn"
                    onclick="snatchVideo()"
                    class="px-8 py-4 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-white font-bold hover:from-cyan-300 hover:to-purple-500 lift transition-all duration-300 whitespace-nowrap"
                >
                    Snatch
                </button>
            </div>
            <div class="text-center mt-4"><div id="errorDisplay"></div></div>
        </div>
        
        <!-- Results Section (Initially Hidden) -->
        <div id="resultsSection" class="hidden">
            <!-- Video Info Card -->
            <div id="videoCard" class="glass rounded-2xl p-6 mb-6 fade-in">
                <div class="flex flex-col sm:flex-row gap-6">
                    <img id="videoThumbnail" src="" alt="Video Thumbnail" class="w-full sm:w-40 h-24 sm:h-28 object-cover rounded-xl">
                    <div class="flex-1">
                        <h3 id="videoTitle" class="text-white font-bold text-lg mb-2"></h3>
                        <p id="videoChannel" class="text-gray-400 text-sm mb-4"></p>
                        <div id="videoDuration" class="text-gray-500 text-xs"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tabbed Download Interface -->
            <div id="downloadSection" class="hidden mt-8">
                <!-- Tab Navigation -->
                <div class="flex justify-center mb-8">
                    <div class="glass rounded-2xl p-2 inline-flex space-x-2">
                        <button id="videoTab" class="tab-btn active-tab px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center space-x-2" onclick="switchTab('video')">
                            <span class="text-2xl">üé•</span>
                            <span>Video</span>
                        </button>
                        <button id="audioTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center space-x-2" onclick="switchTab('audio')">
                            <span class="text-2xl">üéµ</span>
                            <span>Audio</span>
                        </button>
                        <button id="transcriptTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center space-x-2" onclick="switchTab('transcript')">
                            <span class="text-2xl">üìù</span>
                            <span>Transcript</span>
                        </button>
                        <button id="trimTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center space-x-2" onclick="switchTab('trim')">
                            <span class="text-2xl">‚úÇÔ∏è</span>
                            <span>Trim</span>
                        </button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content-container">
                    <!-- Video Download Tab -->
                    <div id="videoContent" class="tab-content active-content">
                        <div class="glass rounded-2xl p-8 max-w-2xl mx-auto">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">üé•</div>
                                <h3 class="text-2xl font-bold text-cyan-400 mb-2">Video Download</h3>
                                <p class="text-gray-400">Download high-quality videos up to 4K resolution</p>
                            </div>
                            
                            <div id="videoOptions" class="flex flex-wrap gap-3 mb-6 justify-center">
                                <!-- Video quality buttons will be inserted here -->
                            </div>
                            
                            <div class="flex justify-center">
                                <button id="downloadVideoBtn" onclick="downloadSelectedVideo()" disabled class="px-10 py-4 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-white font-bold hover:from-cyan-300 hover:to-purple-500 lift transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-lg">
                                    <span class="download-btn-text">Download Video</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Audio Download Tab -->
                    <div id="audioContent" class="tab-content">
                        <div class="glass rounded-2xl p-8 max-w-2xl mx-auto">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">üéµ</div>
                                <h3 class="text-2xl font-bold text-cyan-400 mb-2">Audio Download</h3>
                                <p class="text-gray-400">Extract audio as high-quality MP3 files</p>
                            </div>
                            
                            <div id="audioOptions" class="flex flex-wrap gap-3 mb-6 justify-center">
                                <!-- Audio quality buttons will be inserted here -->
                            </div>
                            
                            <div class="flex justify-center">
                                <button id="downloadAudioBtn" onclick="downloadSelectedAudio()" disabled class="px-10 py-4 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-white font-bold hover:from-cyan-300 hover:to-purple-500 lift transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-lg">
                                    <span class="download-btn-text">Download MP3</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transcript Download Tab -->
                    <div id="transcriptContent" class="tab-content">
                        <div class="glass rounded-2xl p-8 max-w-2xl mx-auto">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">üìù</div>
                                <h3 class="text-2xl font-bold text-cyan-400 mb-2">Transcript Download</h3>
                                <p class="text-gray-400">Get video transcripts with timestamps</p>
                            </div>
                            
                            <div class="flex flex-wrap gap-3 mb-6 justify-center">
                                <button class="transcript-lang-btn px-6 py-3 rounded-full bg-black/40 border border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-black transition-all duration-300 cursor-pointer selected-quality" onclick="selectTranscriptLanguage('en', this)">English</button>
                                <button class="transcript-lang-btn px-6 py-3 rounded-full bg-black/40 border border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-black transition-all duration-300 cursor-pointer" onclick="selectTranscriptLanguage('auto', this)">Auto-detect</button>
                            </div>
                            
                            <div class="flex justify-center">
                                <button id="downloadTranscriptBtn" onclick="downloadTranscript()" class="px-10 py-4 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-white font-bold hover:from-cyan-300 hover:to-purple-500 lift transition-all duration-300 text-lg">
                                    <span class="download-btn-text">Download Transcript</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video Trimming Tab -->
                    <div id="trimContent" class="tab-content">
                        <div class="glass rounded-2xl p-8 max-w-3xl mx-auto">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">‚úÇÔ∏è</div>
                                <h3 class="text-2xl font-bold text-cyan-400 mb-2">Video Trimming</h3>
                                <p class="text-gray-400">Download specific segments with precise control</p>
                            </div>
                            
                            <div class="mb-6">
                                <div class="flex justify-between text-sm text-gray-400 mb-3">
                                    <span class="flex items-center space-x-2">
                                        <span>‚è±Ô∏è</span>
                                        <span>Start: <span id="startTimeDisplay" class="text-cyan-400 font-mono">00:00</span></span>
                                    </span>
                                    <span class="flex items-center space-x-2">
                                        <span>‚úÇÔ∏è</span>
                                        <span>Clip: <span id="segmentDurationDisplay" class="text-cyan-400 font-mono">00:00</span></span>
                                    </span>
                                    <span class="flex items-center space-x-2">
                                        <span>üèÅ</span>
                                        <span>End: <span id="endTimeDisplay" class="text-cyan-400 font-mono">00:00</span></span>
                                    </span>
                                </div>
                                <div class="text-center text-xs text-gray-500 mb-3">
                                    Total video duration: <span id="totalVideoDuration" class="text-gray-400 font-mono">00:00</span>
                                </div>
                                
                                <!-- Enhanced Timeline visualization -->
                                <div class="relative mb-6">
                                    <div class="h-3 bg-black/40 rounded-full relative overflow-hidden border border-cyan-400/20">
                                        <div id="trimSelection" class="h-full bg-gradient-to-r from-cyan-400 to-purple-600 rounded-full absolute shadow-lg" style="left: 0%; width: 100%;"></div>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>0:00</span>
                                        <span id="totalDuration">0:00</span>
                                    </div>
                                </div>
                                
                                <!-- Enhanced Sliders -->
                                <div class="space-y-4 mb-6">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2 flex items-center space-x-2">
                                            <span>üé¨</span>
                                            <span>Start Time</span>
                                        </label>
                                        <input type="range" id="startTimeSlider" min="0" max="100" value="0" 
                                               class="w-full h-3 bg-black/40 rounded-lg appearance-none cursor-pointer slider"
                                               oninput="updateTrimSelection()">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2 flex items-center space-x-2">
                                            <span>üéûÔ∏è</span>
                                            <span>End Time</span>
                                        </label>
                                        <input type="range" id="endTimeSlider" min="0" max="100" value="100" 
                                               class="w-full h-3 bg-black/40 rounded-lg appearance-none cursor-pointer slider"
                                               oninput="updateTrimSelection()">
                                    </div>
                                </div>
                                
                                <!-- Quality selection for trim -->
                                <div class="mb-6">
                                    <label class="block text-sm text-gray-400 mb-3 text-center">Select Quality</label>
                                    <div id="trimVideoOptions" class="flex flex-wrap gap-3 justify-center">
                                        <!-- Video quality buttons will be inserted here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-center">
                                <button id="downloadTrimBtn" onclick="downloadTrimmedVideo()" disabled class="px-10 py-4 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-white font-bold hover:from-cyan-300 hover:to-purple-500 lift transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-lg">
                                    <span class="download-btn-text">Download Trimmed Video</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
        <!-- Status Messages -->
        <div id="statusMessage" class="mt-6 text-center text-gray-400 text-sm font-medium px-4 py-2 rounded-lg min-h-[2rem] flex items-center justify-center"></div>
    </div>

    <script>
        let currentVideoData = null;
        let selectedVideoQuality = null;
        let selectedAudioQuality = null;
        let selectedTranscriptLanguage = 'en';
        let selectedTrimQuality = null;
        let videoDuration = 0;
        let currentTab = 'video';
        
        async function snatchVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const snatchBtn = document.getElementById('snatchBtn');
            const statusMessage = document.getElementById('statusMessage');
            const errorDisplay = document.getElementById('errorDisplay');
            const resultsSection = document.getElementById('resultsSection');

            // Clear previous state
            errorDisplay.classList.remove('visible');
            resultsSection.classList.add('hidden');

            const showError = (message) => {
                errorDisplay.innerHTML = `<span>‚ö†Ô∏è</span> ${message}`;
                errorDisplay.className = 'error-message visible';
            };

            if (!url) {
                showError('Please paste a valid YouTube URL!');
                return;
            }

            // Show loading state
            snatchBtn.innerHTML = '<div class="spinner"></div>';
            snatchBtn.disabled = true;
            showStatus('Snatching video info...', 'loading');

            try {
                const response = await fetch('/api/video-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to fetch video info');
                }

                const data = await response.json();
                currentVideoData = data;
                displayVideoInfo(data);
                showStatus('Video info loaded successfully!', 'success');

            } catch (error) {
                console.error('Video info error:', error);
                showError(error.message);
                showStatus('Failed to snatch video.', 'error');
            } finally {
                snatchBtn.innerHTML = 'Snatch';
                snatchBtn.disabled = false;
            }
        }
        
        function displayVideoInfo(data) {
            // Add the URL to the data object since the backend doesn't return it
            data.url = document.getElementById('videoUrl').value.trim();
            
            document.getElementById('videoTitle').textContent = data.title;
            document.getElementById('videoChannel').textContent = data.author;
            document.getElementById('videoDuration').textContent = `Duration: ${data.duration} seconds | Views: ${data.views}`;
            document.getElementById('videoThumbnail').src = data.thumbnail || '/api/placeholder-thumb';
            
            // Generate video quality buttons
            const videoOptions = document.getElementById('videoOptions');
            videoOptions.innerHTML = '';
            
            const qualities = ['highest', '1080p', '720p', '480p', '360p', 'lowest'];
            qualities.forEach(quality => {
                const button = document.createElement('button');
                button.className = 'quality-btn px-4 py-2 rounded-full bg-black/40 border border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-black transition-all duration-300 cursor-pointer';
                button.textContent = quality;
                button.onclick = () => selectVideoQuality(quality, button);
                videoOptions.appendChild(button);
            });
            
            // Generate audio quality buttons
            const audioOptions = document.getElementById('audioOptions');
            audioOptions.innerHTML = '';
            data.audio_qualities.forEach(quality => {
                const button = document.createElement('button');
                button.className = 'audio-quality-btn px-4 py-2 rounded-full bg-black/40 border border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-black transition-all duration-300 cursor-pointer';
                button.textContent = quality;
                button.onclick = () => selectAudioQuality(quality, button);
                audioOptions.appendChild(button);
            });

            // Set up video trimming
            populateTrimVideoOptions();
            videoDuration = data.duration || 0;
            updateTrimSliders();

            document.getElementById('resultsSection').classList.remove('hidden');
            
            // Initialize tabs and show download section
            initializeTabs();
        }
        
        function selectVideoQuality(quality, button) {
            // Remove selection from all quality buttons
            document.querySelectorAll('.quality-btn').forEach(btn => {
                btn.classList.remove('selected-quality');
            });
            button.classList.add('selected-quality');
            selectedVideoQuality = quality;
            document.getElementById('downloadVideoBtn').disabled = false;
            showStatus(`Selected ${quality} video quality`, 'success');
        }

        function selectAudioQuality(quality, button) {
            document.querySelectorAll('.audio-quality-btn').forEach(btn => {
                btn.classList.remove('selected-quality');
            });
            button.classList.add('selected-quality');
            selectedAudioQuality = quality;
            document.getElementById('downloadAudioBtn').disabled = false;
            showStatus(`Selected ${quality} audio quality`, 'success');
        }

        function selectTranscriptLanguage(language, button) {
            document.querySelectorAll('.transcript-lang-btn').forEach(btn => {
                btn.classList.remove('selected-quality');
            });
            button.classList.add('selected-quality');
            selectedTranscriptLanguage = language;
            showStatus(`Selected ${language === 'en' ? 'English' : 'Auto-detect'} for transcript`, 'success');
        }
        
        async function downloadSelectedVideo() {
            if (!currentVideoData || !selectedVideoQuality) return;
            
            const downloadBtn = document.getElementById('downloadVideoBtn');
            const btnText = downloadBtn.querySelector('.download-btn-text');
            const originalText = btnText.textContent;
            
            // Show loading state
            downloadBtn.classList.add('download-loading');
            downloadBtn.disabled = true;
            btnText.innerHTML = '<div class="spinner inline-block mr-2"></div>Downloading...';
            showStatus(`Downloading ${selectedVideoQuality} video...`, 'loading');
            
            try {
                const response = await fetch('/api/download-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: currentVideoData.url, quality: selectedVideoQuality })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Download failed');
                }
                
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `${currentVideoData.title}_${selectedVideoQuality}.mp4`;
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                
                showStatus('Video downloaded successfully! üéâ', 'success');
                
            } catch (error) {
                showStatus('Download error: ' + error.message, 'error');
            } finally {
                // Reset button state
                downloadBtn.classList.remove('download-loading');
                downloadBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }
        
        async function downloadSelectedAudio() {
            if (!currentVideoData || !selectedAudioQuality) return;
            if (!currentVideoData) return;
            
            const downloadBtn = document.getElementById('downloadAudioBtn');
            const btnText = downloadBtn.querySelector('.download-btn-text');
            const originalText = btnText.textContent;
            
            // Show loading state
            downloadBtn.classList.add('download-loading');
            downloadBtn.disabled = true;
            btnText.innerHTML = '<div class="spinner inline-block mr-2"></div>Downloading...';
            showStatus(`Downloading ${selectedAudioQuality} audio...`, 'loading');
            
            try {
                const response = await fetch('/api/download-audio', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: currentVideoData.url, quality: selectedAudioQuality })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Audio download failed');
                }
                
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `${currentVideoData.title}_${selectedAudioQuality}.mp3`;
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                
                showStatus('Audio downloaded successfully! üéµ', 'success');
                
            } catch (error) {
                showStatus('Audio download error: ' + error.message, 'error');
            } finally {
                // Reset button state
                downloadBtn.classList.remove('download-loading');
                downloadBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }
        
        async function downloadTranscript() {
            if (!currentVideoData) return;
            
            const downloadBtn = document.getElementById('downloadTranscriptBtn');
            const btnText = downloadBtn.querySelector('.download-btn-text');
            const originalText = btnText.textContent;
            
            // Show loading state
            downloadBtn.classList.add('download-loading');
            downloadBtn.disabled = true;
            btnText.innerHTML = '<div class="spinner inline-block mr-2"></div>Downloading...';
            showStatus('Downloading transcript...', 'loading');
            
            try {
                const response = await fetch('/api/download-transcript', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url: currentVideoData.url, 
                        language: selectedTranscriptLanguage 
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Transcript download failed');
                }
                
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `${currentVideoData.title}_transcript.txt`;
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                
                showStatus('Transcript downloaded successfully! üìù', 'success');
                
            } catch (error) {
                let errorMessage = error.message;
                if (errorMessage.includes('Transcript not available')) {
                    errorMessage = 'Transcript not available for this video. The video may not have captions or they may be disabled.';
                }
                showStatus('Transcript error: ' + errorMessage, 'error');
            } finally {
                // Reset button state
                downloadBtn.classList.remove('download-loading');
                downloadBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            
            if (!statusEl) {
                console.error('statusMessage element not found!');
                return;
            }
            
            statusEl.textContent = message;
            
            const styles = {
                loading: 'mt-6 text-center text-sm font-medium px-4 py-2 rounded-lg min-h-[2rem] flex items-center justify-center text-cyan-400 bg-cyan-400/10 border border-cyan-400/20',
                success: 'mt-6 text-center text-sm font-medium px-4 py-2 rounded-lg min-h-[2rem] flex items-center justify-center text-green-400 bg-green-400/10 border border-green-400/20',
                error: 'mt-6 text-center text-sm font-medium px-4 py-2 rounded-lg min-h-[2rem] flex items-center justify-center text-red-400 bg-red-400/10 border border-red-400/20 animate-pulse'
            };
            
            statusEl.className = styles[type] || 'mt-6 text-center text-sm font-medium px-4 py-2 rounded-lg min-h-[2rem] flex items-center justify-center text-gray-400';
        }
        
        function populateTrimVideoOptions(videoStreams) {
            const trimOptions = document.getElementById('trimVideoOptions');
            trimOptions.innerHTML = '';
            
            const qualities = ['highest', '1080p', '720p', '480p', '360p', 'lowest'];
            qualities.forEach(quality => {
                const button = document.createElement('button');
                button.className = 'trim-quality-btn px-4 py-2 rounded-full bg-black/40 border border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-black transition-all duration-300 cursor-pointer';
                button.textContent = quality;
                button.onclick = () => selectTrimQuality(quality, button);
                trimOptions.appendChild(button);
            });
        }
        
        function selectTrimQuality(quality, button) {
            document.querySelectorAll('.trim-quality-btn').forEach(btn => {
                btn.classList.remove('selected-quality');
            });
            button.classList.add('selected-quality');
            selectedTrimQuality = quality;
            checkTrimButtonState();
            showStatus(`Selected ${quality} for trimmed video`, 'success');
        }
        
        function updateTrimSliders() {
            const startSlider = document.getElementById('startTimeSlider');
            const endSlider = document.getElementById('endTimeSlider');
            
            if (videoDuration > 0) {
                startSlider.max = videoDuration;
                endSlider.max = videoDuration;
                endSlider.value = videoDuration;
                
                document.getElementById('totalVideoDuration').textContent = formatTime(videoDuration);
                updateTrimSelection();
            }
        }
        
        function updateTrimSelection() {
            const startSlider = document.getElementById('startTimeSlider');
            const endSlider = document.getElementById('endTimeSlider');
            const startTime = parseFloat(startSlider.value);
            const endTime = parseFloat(endSlider.value);
            
            // Ensure start time is not greater than end time
            if (startTime >= endTime) {
                if (startSlider === document.activeElement) {
                    endSlider.value = Math.min(startTime + 1, videoDuration);
                } else {
                    startSlider.value = Math.max(endTime - 1, 0);
                }
            }
            
            const finalStartTime = parseFloat(startSlider.value);
            const finalEndTime = parseFloat(endSlider.value);
            
            // Calculate segment duration
            const segmentDuration = finalEndTime - finalStartTime;
            
            // Update display
            document.getElementById('startTimeDisplay').textContent = formatTime(finalStartTime);
            document.getElementById('endTimeDisplay').textContent = formatTime(finalEndTime);
            document.getElementById('segmentDurationDisplay').textContent = formatTime(segmentDuration);
            
            // Update visual selection
            const startPercent = (finalStartTime / videoDuration) * 100;
            const endPercent = (finalEndTime / videoDuration) * 100;
            const widthPercent = endPercent - startPercent;
            
            const trimSelection = document.getElementById('trimSelection');
            trimSelection.style.left = startPercent + '%';
            trimSelection.style.width = widthPercent + '%';
            
            // Check if trim button should be enabled
            checkTrimButtonState();
        }
        
        function checkTrimButtonState() {
            const downloadBtn = document.getElementById('downloadTrimBtn');
            const startTime = parseFloat(document.getElementById('startTimeSlider').value);
            const endTime = parseFloat(document.getElementById('endTimeSlider').value);
            
            // Enable button if quality is selected and time range is valid
            const hasValidTimeRange = startTime < endTime && (endTime - startTime) > 0;
            const hasQualitySelected = selectedTrimQuality !== null;
            
            downloadBtn.disabled = !(hasValidTimeRange && hasQualitySelected);
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        async function downloadTrimmedVideo() {
            if (!currentVideoData || !selectedTrimQuality) return;
            
            const startTime = parseFloat(document.getElementById('startTimeSlider').value);
            const endTime = parseFloat(document.getElementById('endTimeSlider').value);
            
            if (startTime >= endTime) {
                showStatus('Invalid time range selected', 'error');
                return;
            }
            
            const downloadBtn = document.getElementById('downloadTrimBtn');
            const btnText = downloadBtn.querySelector('.download-btn-text');
            const originalText = btnText.textContent;
            
            // Show loading state
            downloadBtn.classList.add('download-loading');
            downloadBtn.disabled = true;
            btnText.innerHTML = '<div class="spinner inline-block mr-2"></div>Trimming...';
            showStatus('Downloading and trimming video... This may take a while.', 'loading');
            
            try {
                const response = await fetch('/api/download-video-segment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url: currentVideoData.url, 
                        start_time: startTime,
                        end_time: endTime,
                        quality: selectedTrimQuality 
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Video trimming failed');
                }
                
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                const duration = formatTime(endTime - startTime);
                a.download = `${currentVideoData.title}_${formatTime(startTime)}-${formatTime(endTime)}_${selectedTrimQuality}.mp4`;
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                
                showStatus(`Trimmed video downloaded successfully! Duration: ${duration} ‚úÇÔ∏è`, 'success');
                
            } catch (error) {
                showStatus('Video trimming error: ' + error.message, 'error');
            } finally {
                // Reset button state
                downloadBtn.classList.remove('download-loading');
                downloadBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }

        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active-tab');
            });
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active-content');
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'Content').classList.add('active-content');
            document.getElementById(tabName + 'Tab').classList.add('active-tab');
            
            currentTab = tabName;
            
            // Update total duration display for trim tab
            if (tabName === 'trim' && videoDuration > 0) {
                document.getElementById('totalDuration').textContent = formatTime(videoDuration);
            }
        }
        
        function initializeTabs() {
            // Set default active tab
            switchTab('video');
            
            // Show the download section with fade-in animation
            const downloadSection = document.getElementById('downloadSection');
            downloadSection.classList.remove('hidden');
            downloadSection.classList.add('fade-in');
        }

        // Allow Enter key to trigger search
        document.getElementById('videoUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                snatchVideo();
            }
        });
    </script>
</body>
</html>
